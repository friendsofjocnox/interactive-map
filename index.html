<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>4 Team RTS</title>
<script src="https://cdn.jsdelivr.net/npm/phaser@3/dist/phaser.js"></script>
</head>
<body>

<script>
let socket = new WebSocket("ws://localhost:8080");

let teamColor = "white";
let units = [];
let boss;

const config = {
    type: Phaser.AUTO,
    width: 1000,
    height: 600,
    scene: { create, update }
};

new Phaser.Game(config);

socket.onmessage = (event) => {
    const data = JSON.parse(event.data);

    if (data.type === "init") {
        teamColor = data.team;
    }

    if (data.type === "update") {
        updateGame(data.gameState);
    }
};

function create() {
    this.input.on('pointerdown', pointer => {
        socket.send(JSON.stringify({
            type: "move",
            team: teamColor,
            x: pointer.x,
            y: pointer.y
        }));
    });
}

function updateGame(state) {

    units.forEach(u => u.destroy());
    units = [];

    state.units.forEach(u => {
        let color = {
            blue: 0x0000ff,
            green: 0x00ff00,
            yellow: 0xffff00,
            purple: 0x800080
        }[u.team];

        units.push(
            game.scene.scenes[0].add.circle(u.x, u.y, 10, color)
        );
    });

    if (!boss) {
        boss = game.scene.scenes[0].add.circle(
            state.boss.x,
            state.boss.y,
            20,
            0xff0000
        );
    } else {
        boss.x = state.boss.x;
        boss.y = state.boss.y;
    }
}

function update(){}
</script>

</body>
</html>
